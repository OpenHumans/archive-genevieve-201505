{% extends "base.html" %}
{% block navbar %}
<a href="/accounts/logout"><button type="button" class="btn btn-primary navbar-btn navbar-right">Logout</button></a>
{% endblock %}
{% block content %}
    {# Welcome user #}
    <h3>Welcome {{username}}!</h3>
    {# List genome analyses #}
    <table class="table table-striped">
      {% if genome_analyses %}
      <thead>
	<tr>
	  <th>File Name</th>
	  <th>Date Added</th>
	  <th>Uploaded File</th>
	  <th>Processed File</th>
	  <th>Report</th>
	</tr>
	</thead>
      <tbody>
      {% for genome_analysis in genome_analyses %}
      {% if user == genome_analysis.user %}
      <tr>
	<td>
	  {{ genome_analysis.name }}
	</td>
	<td>
	  {{ genome_analysis.timestamp }} 
	</td>
	<td>
	  <a href="{{ genome_analysis.uploadfile.url }}">Download Uploaded File</a>
	</td>
        {% if genome_analysis.processedfile %}
        <td>
	  <a href="{{ genome_analysis.processedfile.url }}">Download Processed File</a>
	</td>    
	{% if genome_analysis.variants %}
	<td>
	  <a href="report/{{ genome_analysis.id }}/">View Report</a>
	</td>
      </tr>
      {% endif %}
      {% else %}
      File processing not complete.
      {% endif %}
      {% endif %}
    {% endfor %}
{% else %}
<p>No files uploaded.</p>
{% endif %}

{# Note enctype 'multipart/form-data' for upload of files. #}

<form role="form" action="{% url 'list' %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
      <div class="form-group">
	{% if form.uploadfile.errors %}
	<div class="alert alert-danger" role="alert">{{ form.uploadfile.errors }}</div>
	{% endif %}
	<input type="file" id="id_uploadfile"  name="uploadfile">
	<p class="help-block">Please upload a gzipped vcf file</p>
      </div>
      <div class="form-group">
	{% if form.reportname.errors %}
        <div class="alert alert-danger" role="alert">{{ form.reportname.errors }}</div>
        {% endif %}
	<input type="text" id="id_reportname" class="form-control" name="reportname" type="text"
	       placeholder="Enter Filename">
      </div>
      <p><button type="submit" class="btn btn-default">Submit</button></p>
    </form>

{% endblock %}
